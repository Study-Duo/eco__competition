<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»ªè¡¨æ¿ - TEGç›‘æµ‹ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“ˆ TEGç»¼åˆä»ªè¡¨æ¿</h1>
            <p class="subtitle">æ··åˆæ¨¡å¼ - æ•°æ®æ±‡æ€»ä¸æ€§èƒ½åˆ†æ</p>
            <div class="header-actions">
                <a href="index.html" class="btn btn-outline">
                    <span class="btn-icon">â†</span>
                    <span class="btn-text">è¿”å›é¦–é¡µ</span>
                </a>
                <button id="btnAutoRefresh" class="btn btn-success" onclick="toggleAutoRefresh()">
                    <span class="btn-icon">ğŸ”„</span>
                    <span class="btn-text">è‡ªåŠ¨åˆ·æ–°</span>
                </button>
            </div>
        </header>
        
        <!-- å¯¼èˆªèœå• -->
        <nav>
            <a href="index.html" class="nav-link">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-text">é¦–é¡µ</span>
            </a>
            <a href="analysis.html" class="nav-link">
                <span class="nav-icon">ğŸ“Š</span>
                <span class="nav-text">æ•°æ®åˆ†æ</span>
            </a>
            <a href="realtime.html" class="nav-link">
                <span class="nav-icon">ğŸ“¡</span>
                <span class="nav-text">å®æ—¶ç›‘æµ‹</span>
            </a>
            <a href="dashboard.html" class="nav-link active">
                <span class="nav-icon">ğŸ“ˆ</span>
                <span class="nav-text">ä»ªè¡¨æ¿</span>
            </a>
        </nav>
        
        <!-- æ¦‚è¦ç»Ÿè®¡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">æ€»æ•°æ®ç‚¹æ•°</div>
                <div class="stat-value" id="statTotalData">0</div>
                <div class="stat-range" id="statDataRange">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">å¹³å‡æ¸©å·®</div>
                <div class="stat-value" id="statAvgTempDiff">0.00 Â°C</div>
                <div class="stat-range" id="statTempRange">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">å¹³å‡ç”µå‹</div>
                <div class="stat-value" id="statAvgVoltage">0.000 V</div>
                <div class="stat-range" id="statVoltageRange">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">æœ€å¤§åŠŸç‡</div>
                <div class="stat-value" id="statMaxPower">0.00 mW</div>
                <div class="stat-range" id="statPowerRange">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">å¹³å‡æ•ˆç‡</div>
                <div class="stat-value" id="statAvgEfficiency">0.00 %</div>
                <div class="stat-range" id="statEfficiencyRange">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">å¡è´å…‹ç³»æ•°</div>
                <div class="stat-value" id="statAvgSeebeck">0.00 mV/Â°C</div>
                <div class="stat-range" id="statSeebeckRange">--</div>
            </div>
        </div>
        
        <!-- ä¸»è¦å›¾è¡¨åŒº -->
        <div class="dashboard">
            <!-- æ€§èƒ½è¶‹åŠ¿å›¾ -->
            <div class="card chart-card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ“ˆ æ€§èƒ½è¶‹åŠ¿</h2>
                    <div class="card-actions">
                        <select id="trendPeriod" class="form-control" onchange="updateTrendChart()">
                            <option value="1h">1å°æ—¶</option>
                            <option value="6h">6å°æ—¶</option>
                            <option value="24h" selected>24å°æ—¶</option>
                            <option value="7d">7å¤©</option>
                        </select>
                    </div>
                </div>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="performanceTrendChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- æ•ˆç‡åˆ†å¸ƒå›¾ -->
            <div class="card chart-card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ“Š æ•ˆç‡åˆ†å¸ƒ</h2>
                    <div class="card-actions">
                        <button class="btn btn-sm btn-outline" onclick="toggleChartType('efficiencyDistributionChart')">
                            <span class="btn-icon">ğŸ“Š</span>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="efficiencyDistributionChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- æ¸©å·®-åŠŸç‡ç‰¹æ€§ -->
            <div class="card chart-card">
                <div class="card-header">
                    <h2 class="card-title">âš¡ æ¸©å·®-åŠŸç‡ç‰¹æ€§</h2>
                    <div class="card-actions">
                        <button class="btn btn-sm btn-outline" onclick="toggleChartType('powerCharacteristicChart')">
                            <span class="btn-icon">ğŸ“Š</span>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="powerCharacteristicChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- å®æ—¶çŠ¶æ€ç›‘æ§ -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ” å®æ—¶çŠ¶æ€</h2>
                    <div class="card-actions">
                        <button class="btn btn-sm btn-primary" onclick="refreshStatus()">
                            <span class="btn-icon">ğŸ”„</span>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="status-grid" id="statusGrid">
                        <!-- çŠ¶æ€ä¿¡æ¯ä¼šåŠ¨æ€æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                    </div>
                </div>
            </div>
            
            <!-- ç³»ç»Ÿé…ç½® -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">âš™ï¸ ç³»ç»Ÿé…ç½®</h2>
                </div>
                <div class="card-content">
                    <div class="config-summary" id="configSummary">
                        <!-- é…ç½®ä¿¡æ¯ä¼šåŠ¨æ€æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                    </div>
                </div>
            </div>
            
            <!-- æ•°æ®æ–‡ä»¶ç®¡ç† -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ’¾ æ•°æ®æ–‡ä»¶</h2>
                    <div class="card-actions">
                        <button class="btn btn-sm btn-success" onclick="loadFileList()">
                            <span class="btn-icon">ğŸ”„</span>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="file-summary" id="fileSummary">
                        <!-- æ–‡ä»¶ä¿¡æ¯ä¼šåŠ¨æ€æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å‘Šè­¦é¢æ¿ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">âš ï¸ ç³»ç»Ÿå‘Šè­¦</h2>
                <div class="card-actions">
                    <button class="btn btn-sm btn-outline" onclick="clearAlerts()">
                        <span class="btn-icon">ğŸ—‘ï¸</span>
                        <span class="btn-text">æ¸…ç©º</span>
                    </button>
                </div>
            </div>
            <div class="card-content">
                <div class="alerts-container" id="alertsContainer">
                    <div class="alert alert-info">
                        <div class="alert-icon">â„¹ï¸</div>
                        <div class="alert-content">
                            <div class="alert-title">ç³»ç»Ÿæ­£å¸¸</div>
                            <div class="alert-message">æ‰€æœ‰ç»„ä»¶è¿è¡Œæ­£å¸¸</div>
                        </div>
                        <div class="alert-time">åˆšåˆš</div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <div class="footer-content">
                <div class="footer-info">
                    <p>ä»ªè¡¨æ¿æ›´æ–°æ—¶é—´: <span id="dashboardUpdateTime">--:--:--</span></p>
                    <p>æ•°æ®æº: <span id="dataSource">æœ¬åœ°æœåŠ¡å™¨</span></p>
                </div>
                <div class="footer-actions">
                    <button class="btn btn-sm btn-outline" onclick="exportDashboard()">
                        <span class="btn-icon">ğŸ“¤</span>
                        <span class="btn-text">å¯¼å‡ºæ•°æ®</span>
                    </button>
                    <button class="btn btn-sm btn-outline" onclick="printDashboard()">
                        <span class="btn-icon">ğŸ–¨ï¸</span>
                        <span class="btn-text">æ‰“å°</span>
                    </button>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScriptä»£ç  -->
    <script>
        // å…¨å±€å˜é‡
        let dashboardCharts = {};
        let autoRefreshInterval = null;
        let autoRefreshEnabled = false;
        let dashboardData = {
            summary: {},
            trends: [],
            status: {},
            config: {},
            files: []
        };
        
        // DOMåŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–å›¾è¡¨
            initDashboardCharts();
            
            // åŠ è½½æ•°æ®
            loadDashboardData();
            
            // å¼€å§‹è‡ªåŠ¨åˆ·æ–°
            startAutoRefresh();
            
            // æ›´æ–°æ—¶é—´æ˜¾ç¤º
            updateTime();
            setInterval(updateTime, 1000);
        });
        
        // åˆå§‹åŒ–ä»ªè¡¨æ¿å›¾è¡¨
        function initDashboardCharts() {
            // æ€§èƒ½è¶‹åŠ¿å›¾
            const trendCtx = document.getElementById('performanceTrendChart').getContext('2d');
            dashboardCharts.performanceTrend = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'æ¸©å·®',
                            data: [],
                            borderColor: '#ff6384',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y'
                        },
                        {
                            label: 'åŠŸç‡',
                            data: [],
                            borderColor: '#4bc0c0',
                            backgroundColor: 'rgba(75, 192, 192, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'æ—¶é—´'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'æ¸©å·® (Â°C)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'åŠŸç‡ (mW)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
            
            // æ•ˆç‡åˆ†å¸ƒå›¾
            const effCtx = document.getElementById('efficiencyDistributionChart').getContext('2d');
            dashboardCharts.efficiencyDistribution = new Chart(effCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'æ•ˆç‡åˆ†å¸ƒ',
                        data: [],
                        backgroundColor: 'rgba(153, 102, 255, 0.6)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'æ•ˆç‡èŒƒå›´ (%)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'æ•°æ®ç‚¹æ•°'
                            },
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // åŠŸç‡ç‰¹æ€§å›¾
            const powerCtx = document.getElementById('powerCharacteristicChart').getContext('2d');
            dashboardCharts.powerCharacteristic = new Chart(powerCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'æ¸©å·®-åŠŸç‡ç‰¹æ€§',
                        data: [],
                        borderColor: '#ff9f40',
                        backgroundColor: 'rgba(255, 159, 64, 0.5)',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'æ¸©å·® (Â°C)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'åŠŸç‡ (mW)'
                            }
                        }
                    }
                }
            });
        }
        
        // åŠ è½½ä»ªè¡¨æ¿æ•°æ®
        async function loadDashboardData() {
            try {
                // åŠ è½½æ±‡æ€»æ•°æ®
                await loadSummaryData();
                
                // åŠ è½½è¶‹åŠ¿æ•°æ®
                await loadTrendData();
                
                // åŠ è½½çŠ¶æ€æ•°æ®
                await loadStatusData();
                
                // åŠ è½½é…ç½®æ•°æ®
                await loadConfigData();
                
                // åŠ è½½æ–‡ä»¶æ•°æ®
                await loadFileList();
                
                // æ›´æ–°æ˜¾ç¤º
                updateDashboardDisplay();
                
            } catch (error) {
                console.error('åŠ è½½ä»ªè¡¨æ¿æ•°æ®å¤±è´¥:', error);
                showAlert('error', 'åŠ è½½æ•°æ®å¤±è´¥: ' + error.message);
            }
        }
        
        // åŠ è½½æ±‡æ€»æ•°æ®
        async function loadSummaryData() {
            try {
                const response = await fetch('/api/statistics');
                const data = await response.json();
                
                if (data.status === 'ok') {
                    dashboardData.summary = data;
                }
            } catch (error) {
                console.error('åŠ è½½æ±‡æ€»æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½è¶‹åŠ¿æ•°æ®
        async function loadTrendData() {
            try {
                const response = await fetch('/api/data/all');
                const data = await response.json();
                
                if (Array.isArray(data)) {
                    dashboardData.trends = data;
                }
            } catch (error) {
                console.error('åŠ è½½è¶‹åŠ¿æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½çŠ¶æ€æ•°æ®
        async function loadStatusData() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                dashboardData.status = data;
            } catch (error) {
                console.error('åŠ è½½çŠ¶æ€æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½é…ç½®æ•°æ®
        async function loadConfigData() {
            try {
                const response = await fetch('/api/config');
                const data = await response.json();
                
                dashboardData.config = data;
            } catch (error) {
                console.error('åŠ è½½é…ç½®æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½æ–‡ä»¶åˆ—è¡¨
        async function loadFileList() {
            try {
                const response = await fetch('/api/saved_files');
                const files = await response.json();
                
                dashboardData.files = files;
                updateFileSummary(files);
            } catch (error) {
                console.error('åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°ä»ªè¡¨æ¿æ˜¾ç¤º
        function updateDashboardDisplay() {
            // æ›´æ–°æ¦‚è¦ç»Ÿè®¡
            updateSummaryStats();
            
            // æ›´æ–°å›¾è¡¨
            updateCharts();
            
            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            updateStatusDisplay();
            
            // æ›´æ–°é…ç½®æ˜¾ç¤º
            updateConfigDisplay();
            
            // æ›´æ–°æ—¶é—´
            updateDashboardTime();
        }
        
        // æ›´æ–°æ¦‚è¦ç»Ÿè®¡
        function updateSummaryStats() {
            const summary = dashboardData.summary;
            
            if (summary.data_points) {
                document.getElementById('statTotalData').textContent = summary.data_points;
                
                // è®¡ç®—æ•°æ®èŒƒå›´
                if (dashboardData.trends.length > 0) {
                    const first = dashboardData.trends[0];
                    const last = dashboardData.trends[dashboardData.trends.length - 1];
                    const duration = (last.timestamp - first.timestamp) / 1000;
                    document.getElementById('statDataRange').textContent = 
                        `${duration.toFixed(1)} ç§’`;
                }
            }
            
            if (summary.temp_diff) {
                document.getElementById('statAvgTempDiff').textContent = 
                    `${summary.temp_diff.mean.toFixed(2)} Â°C`;
                document.getElementById('statTempRange').textContent = 
                    `${summary.temp_diff.min.toFixed(1)} - ${summary.temp_diff.max.toFixed(1)} Â°C`;
            }
            
            if (summary.voltage) {
                document.getElementById('statAvgVoltage').textContent = 
                    `${summary.voltage.mean.toFixed(3)} V`;
                document.getElementById('statVoltageRange').textContent = 
                    `${summary.voltage.min.toFixed(3)} - ${summary.voltage.max.toFixed(3)} V`;
            }
            
            if (summary.power) {
                document.getElementById('statMaxPower').textContent = 
                    `${summary.power.max.toFixed(2)} mW`;
                document.getElementById('statPowerRange').textContent = 
                    `${summary.power.mean.toFixed(2)} mW (å¹³å‡)`;
            }
            
            if (summary.seebeck) {
                document.getElementById('statAvgSeebeck').textContent = 
                    `${summary.seebeck.mean.toFixed(2)} mV/Â°C`;
            }
        }
        
        // æ›´æ–°å›¾è¡¨
        function updateCharts() {
            updateTrendChart();
            updateEfficiencyDistribution();
            updatePowerCharacteristic();
        }
        
        // æ›´æ–°è¶‹åŠ¿å›¾è¡¨
        function updateTrendChart() {
            const period = document.getElementById('trendPeriod').value;
            let filteredData = dashboardData.trends;
            
            // æ ¹æ®æ—¶é—´æ®µè¿‡æ»¤æ•°æ®
            if (period === '1h') {
                const oneHourAgo = Date.now() - 60 * 60 * 1000;
                filteredData = dashboardData.trends.filter(d => d.timestamp >= oneHourAgo);
            } else if (period === '6h') {
                const sixHoursAgo = Date.now() - 6 * 60 * 60 * 1000;
                filteredData = dashboardData.trends.filter(d => d.timestamp >= sixHoursAgo);
            } else if (period === '24h') {
                const oneDayAgo = Date.now() - 24 * 60 * 60 * 1000;
                filteredData = dashboardData.trends.filter(d => d.timestamp >= oneDayAgo);
            } else if (period === '7d') {
                const sevenDaysAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
                filteredData = dashboardData.trends.filter(d => d.timestamp >= sevenDaysAgo);
            }
            
            if (filteredData.length === 0) return;
            
            // å‡†å¤‡å›¾è¡¨æ•°æ®
            const labels = filteredData.map(d => 
                new Date(d.timestamp).toLocaleTimeString()
            );
            
            const tempData = filteredData.map(d => d.temp_diff);
            const powerData = filteredData.map(d => d.power);
            
            // æ›´æ–°å›¾è¡¨
            dashboardCharts.performanceTrend.data.labels = labels;
            dashboardCharts.performanceTrend.data.datasets[0].data = tempData;
            dashboardCharts.performanceTrend.data.datasets[1].data = powerData;
            dashboardCharts.performanceTrend.update();
        }
        
        // æ›´æ–°æ•ˆç‡åˆ†å¸ƒ
        function updateEfficiencyDistribution() {
            const efficiencies = dashboardData.trends
                .map(d => d.efficiency)
                .filter(e => e >= 0 && e <= 100);
            
            if (efficiencies.length === 0) return;
            
            // è®¡ç®—ç›´æ–¹å›¾
            const bins = [0, 1, 2, 5, 10, 20, 50, 100];
            const counts = new Array(bins.length - 1).fill(0);
            const labels = [];
            
            efficiencies.forEach(efficiency => {
                for (let i = 0; i < bins.length - 1; i++) {
                    if (efficiency >= bins[i] && efficiency < bins[i + 1]) {
                        counts[i]++;
                        break;
                    }
                }
            });
            
            // åˆ›å»ºæ ‡ç­¾
            for (let i = 0; i < bins.length - 1; i++) {
                labels.push(`${bins[i]}-${bins[i + 1]}%`);
            }
            
            // æ›´æ–°å›¾è¡¨
            dashboardCharts.efficiencyDistribution.data.labels = labels;
            dashboardCharts.efficiencyDistribution.data.datasets[0].data = counts;
            dashboardCharts.efficiencyDistribution.update();
        }
        
        // æ›´æ–°åŠŸç‡ç‰¹æ€§
        function updatePowerCharacteristic() {
            const data = dashboardData.trends.map(d => ({
                x: d.temp_diff,
                y: d.power
            }));
            
            dashboardCharts.powerCharacteristic.data.datasets[0].data = data;
            dashboardCharts.powerCharacteristic.update();
        }
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatusDisplay() {
            const status = dashboardData.status;
            const container = document.getElementById('statusGrid');
            
            let html = `
                <div class="status-item">
                    <div class="status-label">æœåŠ¡å™¨çŠ¶æ€</div>
                    <div class="status-value status-online">è¿è¡Œä¸­</div>
                </div>
                <div class="status-item">
                    <div class="status-label">è¿è¡Œæ—¶é—´</div>
                    <div class="status-value">${formatUptime(status.timestamp || Date.now())}</div>
                </div>
                <div class="status-item">
                    <div class="status-label">æ•°æ®ç‚¹æ•°</div>
                    <div class="status-value">${dashboardData.trends.length}</div>
                </div>
                <div class="status-item">
                    <div class="status-label">æœ€åæ›´æ–°</div>
                    <div class="status-value">${new Date().toLocaleTimeString()}</div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // æ›´æ–°é…ç½®æ˜¾ç¤º
        function updateConfigDisplay() {
            const config = dashboardData.config;
            const container = document.getElementById('configSummary');
            
            let html = `
                <div class="config-item">
                    <div class="config-label">è´Ÿè½½ç”µé˜»</div>
                    <div class="config-value">${config.load_resistance || 10.0} Î©</div>
                </div>
                <div class="config-item">
                    <div class="config-label">TEGå†…é˜»</div>
                    <div class="config-value">${config.teg_resistance || 4.0} Î©</div>
                </div>
                <div class="config-item">
                    <div class="config-label">å¡è´å…‹ç³»æ•°</div>
                    <div class="config-value">${config.seebeck_coefficient || 40.0} mV/Â°C</div>
                </div>
                <div class="config-item">
                    <div class="config-label">ä¸²å£ç«¯å£</div>
                    <div class="config-value">${config.port || 'è‡ªåŠ¨æ£€æµ‹'}</div>
                </div>
                <div class="config-item">
                    <div class="config-label">æ³¢ç‰¹ç‡</div>
                    <div class="config-value">${config.baudrate || 115200}</div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // æ›´æ–°æ–‡ä»¶æ‘˜è¦
        function updateFileSummary(files) {
            const container = document.getElementById('fileSummary');
            
            if (files.length === 0) {
                container.innerHTML = '<p class="text-secondary">æš‚æ— æ•°æ®æ–‡ä»¶</p>';
                return;
            }
            
            // è®¡ç®—æ€»å¤§å°
            const totalSize = files.reduce((sum, file) => sum + file.size, 0);
            const newestFile = files.reduce((newest, file) => 
                file.modified > newest.modified ? file : newest, files[0]
            );
            
            let html = `
                <div class="file-summary-stats">
                    <div class="file-stat">
                        <div class="file-stat-label">æ–‡ä»¶æ•°é‡</div>
                        <div class="file-stat-value">${files.length}</div>
                    </div>
                    <div class="file-stat">
                        <div class="file-stat-label">æ€»å¤§å°</div>
                        <div class="file-stat-value">${formatFileSize(totalSize)}</div>
                    </div>
                    <div class="file-stat">
                        <div class="file-stat-label">æœ€æ–°æ–‡ä»¶</div>
                        <div class="file-stat-value">${newestFile.name}</div>
                    </div>
                </div>
                <div class="recent-files">
                    <h4>æœ€è¿‘æ–‡ä»¶</h4>
                    <ul>
            `;
            
            // æ˜¾ç¤ºæœ€è¿‘5ä¸ªæ–‡ä»¶
            files
                .sort((a, b) => b.modified - a.modified)
                .slice(0, 5)
                .forEach(file => {
                    html += `
                        <li>
                            <span class="file-name">${file.name}</span>
                            <span class="file-size">${formatFileSize(file.size)}</span>
                            <span class="file-modified">${new Date(file.modified * 1000).toLocaleDateString()}</span>
                        </li>
                    `;
                });
            
            html += `
                    </ul>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // åˆ‡æ¢å›¾è¡¨ç±»å‹
        function toggleChartType(chartId) {
            const chart = dashboardCharts[chartId];
            const types = ['bar', 'line', 'scatter'];
            const currentType = chart.config.type;
            const nextType = types[(types.indexOf(currentType) + 1) % types.length];
            
            chart.config.type = nextType;
            chart.update();
        }
        
        // åˆ·æ–°çŠ¶æ€
        function refreshStatus() {
            loadDashboardData();
            showAlert('info', 'ä»ªè¡¨æ¿æ•°æ®å·²åˆ·æ–°');
        }
        
        // åˆ‡æ¢è‡ªåŠ¨åˆ·æ–°
        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const button = document.getElementById('btnAutoRefresh');
            
            if (autoRefreshEnabled) {
                startAutoRefresh();
                button.classList.remove('btn-success');
                button.classList.add('btn-warning');
                button.innerHTML = '<span class="btn-icon">â¸ï¸</span><span class="btn-text">æš‚åœåˆ·æ–°</span>';
                showAlert('info', 'å·²å¯ç”¨è‡ªåŠ¨åˆ·æ–°ï¼ˆæ¯30ç§’ï¼‰');
            } else {
                stopAutoRefresh();
                button.classList.remove('btn-warning');
                button.classList.add('btn-success');
                button.innerHTML = '<span class="btn-icon">ğŸ”„</span><span class="btn-text">è‡ªåŠ¨åˆ·æ–°</span>';
                showAlert('info', 'å·²ç¦ç”¨è‡ªåŠ¨åˆ·æ–°');
            }
        }
        
        // å¼€å§‹è‡ªåŠ¨åˆ·æ–°
        function startAutoRefresh() {
            stopAutoRefresh(); // å…ˆåœæ­¢ç°æœ‰çš„
            autoRefreshInterval = setInterval(loadDashboardData, 30000); // æ¯30ç§’
        }
        
        // åœæ­¢è‡ªåŠ¨åˆ·æ–°
        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }
        
        // æ¸…ç©ºå‘Šè­¦
        function clearAlerts() {
            const container = document.getElementById('alertsContainer');
            container.innerHTML = `
                <div class="alert alert-info">
                    <div class="alert-icon">â„¹ï¸</div>
                    <div class="alert-content">
                        <div class="alert-title">å‘Šè­¦å·²æ¸…ç©º</div>
                        <div class="alert-message">æ‰€æœ‰å‘Šè­¦ä¿¡æ¯å·²æ¸…é™¤</div>
                    </div>
                    <div class="alert-time">åˆšåˆš</div>
                </div>
            `;
        }
        
        // æ˜¾ç¤ºå‘Šè­¦
        function showAlert(type, message) {
            const container = document.getElementById('alertsContainer');
            const types = {
                info: { icon: 'â„¹ï¸', title: 'ä¿¡æ¯' },
                warning: { icon: 'âš ï¸', title: 'è­¦å‘Š' },
                error: { icon: 'âŒ', title: 'é”™è¯¯' },
                success: { icon: 'âœ…', title: 'æˆåŠŸ' }
            };
            
            const alertType = types[type] || types.info;
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <div class="alert-icon">${alertType.icon}</div>
                <div class="alert-content">
                    <div class="alert-title">${alertType.title}</div>
                    <div class="alert-message">${message}</div>
                </div>
                <div class="alert-time">åˆšåˆš</div>
            `;
            
            container.insertBefore(alert, container.firstChild);
            
            // é™åˆ¶å‘Šè­¦æ•°é‡
            if (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
        }
        
        // å¯¼å‡ºä»ªè¡¨æ¿æ•°æ®
        function exportDashboard() {
            const data = {
                summary: dashboardData.summary,
                config: dashboardData.config,
                timestamp: Date.now()
            };
            
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `teg_dashboard_${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('success', 'ä»ªè¡¨æ¿æ•°æ®å·²å¯¼å‡º');
        }
        
        // æ‰“å°ä»ªè¡¨æ¿
        function printDashboard() {
            window.print();
        }
        
        // æ ¼å¼åŒ–è¿è¡Œæ—¶é—´
        function formatUptime(timestamp) {
            const uptime = Math.floor((Date.now() - timestamp) / 1000);
            
            if (uptime < 60) {
                return `${uptime}ç§’`;
            } else if (uptime < 3600) {
                return `${Math.floor(uptime / 60)}åˆ†é’Ÿ`;
            } else if (uptime < 86400) {
                return `${Math.floor(uptime / 3600)}å°æ—¶`;
            } else {
                return `${Math.floor(uptime / 86400)}å¤©`;
            }
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTime() {
            const now = new Date();
            document.getElementById('dashboardUpdateTime').textContent = 
                now.toLocaleTimeString('zh-CN');
        }
        
        function updateDashboardTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('dashboardUpdateTime').textContent = timeStr;
        }
        
        // é¡µé¢å¸è½½å‰æ¸…ç†
        window.addEventListener('beforeunload', function() {
            stopAutoRefresh();
        });
    </script>
    
    <style>
        /* ä»ªè¡¨æ¿ç‰¹å®šæ ·å¼ */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
        }
        
        .status-item {
            padding: var(--spacing-md);
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
        }
        
        .config-summary {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }
        
        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-md);
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-sm);
        }
        
        .config-label {
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .config-value {
            font-weight: 600;
            color: var(--text-primary);
            font-family: monospace;
        }
        
        .file-summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }
        
        .file-stat {
            text-align: center;
            padding: var(--spacing-md);
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
        }
        
        .file-stat-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
        }
        
        .file-stat-value {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .recent-files ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .recent-files li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-md);
            margin-bottom: var(--spacing-xs);
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-sm);
        }
        
        .recent-files li:hover {
            background-color: var(--bg-primary);
        }
        
        .alerts-container {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            max-height: 300px;
            overflow-y: auto;
        }
        
        .alert {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            border-left: 4px solid;
        }
        
        .alert-info {
            background-color: rgba(52, 152, 219, 0.1);
            border-left-color: var(--info-color);
        }
        
        .alert-warning {
            background-color: rgba(243, 156, 18, 0.1);
            border-left-color: var(--warning-color);
        }
        
        .alert-error {
            background-color: rgba(231, 76, 60, 0.1);
            border-left-color: var(--danger-color);
        }
        
        .alert-success {
            background-color: rgba(46, 204, 113, 0.1);
            border-left-color: var(--success-color);
        }
        
        .alert-icon {
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .alert-content {
            flex: 1;
        }
        
        .alert-title {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }
        
        .alert-message {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }
        
        .alert-time {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            flex-shrink: 0;
        }
    </style>
</body>
</html>